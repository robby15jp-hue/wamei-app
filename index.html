<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>当て字ジェネレーター | English → Kanji</title>
<style>
  :root{--bg:#fafafa;--card:#fff;--text:#222;--muted:#666;--line:#e5e7eb;--p:#4f46e5}
  *{box-sizing:border-box}
  body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans JP',sans-serif;background:var(--bg);color:var(--text);margin:0}
  .app{max-width:940px;margin:0 auto;padding:20px}
  h1{font-size:22px;margin:6px 0 14px}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin:6px 0}
  input,button{font-size:16px;padding:10px;border:1px solid var(--line);border-radius:10px;background:#fff}
  input{flex:1;min-width:280px}
  button{background:var(--p);color:#fff;border:none;cursor:pointer}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:14px;margin-top:14px}
  .hit{font-size:22px;line-height:1.25;margin:8px 0}
  .kana{margin-left:6px;color:#666;font-size:14px}
  .copybtn{font-size:12px;padding:6px 8px;margin-left:8px;border:1px solid var(--line);background:#fff;color:#333;border-radius:8px;cursor:pointer}
  .tips{color:#666;font-size:14px}
  .desc-foreign{color:#2563eb;font-weight:bold;margin:6px 0 2px}
  .desc-jp{color:#555;margin:0 0 8px}
  .badge{display:inline-block;margin-left:8px;padding:2px 8px;border:1px solid var(--line);border-radius:999px;font-size:12px;color:#666}
  .suggest a{display:inline-block;margin:4px 6px 0 0;padding:6px 10px;border:1px solid var(--line);border-radius:999px;color:#333;text-decoration:none}
  hr.sep{border:none;border-top:1px solid var(--line);margin:12px 0}
  footer{color:#777;font-size:12px;margin-top:18px}
</style>
</head>
<body>
<div class="app">
  <h1>英語名／姓 → 当て字変換</h1>
  <p class="desc-foreign">🌐 Enter an English first/last name (ex: William, Tom, Bill Gates). Case-insensitive.</p>
  <p class="desc-jp">英語の名前または姓を入力してください（例：ウィリアム／トム／Bill Gates）。大文字小文字は区別しません。</p>

  <div class="row">
    <input id="q" placeholder="Name / Full name (ex: William / Tom / Bill Gates)" autocomplete="off">
    <button id="go">変換</button>
  </div>

  <div id="out" class="card">準備OK。William / Tom / Mike / Bill / Ken / Kent / “Bill Gates” などでテストしてください。</div>
  <footer>辞書は <code>db</code>、別名は <code>aliases</code> に追記。フルネームは最大8語まで処理。</footer>
</div>

<script>
/* ============= ユーティリティ ============= */
const norm = s => (s||'').toLowerCase().trim();
function escapeHtml(s){return (s+"").replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));}
function copyText(t){navigator.clipboard?.writeText(t);}
const out = document.getElementById('out');
document.getElementById('go').addEventListener('click', convert);
document.getElementById('q').addEventListener('keydown', e=>{ if(e.key==='Enter') convert(); });

/* ============= 無視語リスト（Jr., Mr., III…） ============= */
const STOPWORDS = new Set([
  "jr","sr","ii","iii","iv","v","vi",
  "mr","mrs","ms","dr","prof",
  "de","del","della","du","des","la","le","les","da","das","dos","di",
  "van","von","der","den","ter","ten","op","af","al","bin","ibn","ben",
  "the","and","of"
]);
function tokenize(raw){
  let s = (raw||"").replace(/\u3000/g," ").replace(/\s+/g," ").trim();
  s = s.replace(/[^A-Za-z\s]/g," ");
  let parts = s.split(/\s+/).filter(Boolean);
  return parts.filter(w=>!STOPWORDS.has(w.toLowerCase()));
}

/* ============= 当て字データ ============= */
const db = {
  "william":{variants:[["宇井利愛夢","ウィリアム"]],desc:{foreign:"🌐 Germanic; “resolute protector.”",extra:"✦ Borne by many kings.",jp:"日本語: 強い守護者。王侯名として著名。"}},
  "tom":{variants:[["富夢","トム"]],desc:{foreign:"🌐 Short form of Thomas; also independent.",extra:"✦ Friendly, global.",jp:"日本語: トーマスの短縮だが独立名としても普及。"}},
  "bill":{variants:[["美留","ビル"]],desc:{foreign:"🌐 Nickname of William; also standalone.",extra:"✦ Very common US/UK.",jp:"日本語: Williamの愛称。単体名としても使用。"}},
  "kenneth":{variants:[["健奈須","ケネス"]],desc:{foreign:"🌐 English/Scottish given name.",extra:"✦ Often shortened to Ken.",jp:"日本語: 英語/スコットランド系。"}},
  "ken":{variants:[["健","ケン"]],desc:{foreign:"🌐 Short form of Kenneth; independent too.",extra:"✦ Crisp, international.",jp:"日本語: Kennethの短縮。独立名としても一般的。"}},
  "kent":{variants:[["健斗","ケント"]],desc:{foreign:"🌐 Given name/surname; also UK county.",extra:"✦ Modern, brisk.",jp:"日本語: 名/姓両方にある。軽快。"}},
  "steve":{variants:[["捨威","スティーブ"]],desc:{foreign:"🌐 Short form of Steven/Stephen.",extra:"✦ Friendly impression.",jp:"日本語: Stevenの愛称。親しみやすい。"}},
  "john":{variants:[["常治","ジョン"]],desc:{foreign:"🌐 Hebrew; “God is gracious.”",extra:"✦ Foundational classic.",jp:"日本語: 伝統的古典名。著名人多数。"}},
  "mike":{variants:[["舞家留","マイク"]],desc:{foreign:"🌐 Nickname of Michael.",extra:"✦ Casual tone.",jp:"日本語: Michaelの愛称。"}},
  "charles":{variants:[["茶瑠図","チャールズ"]],desc:{foreign:"🌐 Germanic; “free man.”",extra:"✦ Regal name.",jp:"日本語: 自由人の意。"}},
  "elizabeth":{variants:[["栄利座辺寿","エリザベス"]],desc:{foreign:"🌐 “pledged to God.”",extra:"✦ Many nicknames.",jp:"日本語: 神に捧げられた。愛称多数。"}},
  "sophia":{variants:[["素麸衣亜","ソフィア"]],desc:{foreign:"🌐 Greek; “wisdom.”",extra:"✦ Global popularity.",jp:"日本語: 知恵の意。"}},
  "scarlett":{variants:[["好華亜烈都","スカーレット"]],desc:{foreign:"🌐 Word-name (red).",extra:"✦ Glamorous.",jp:"日本語: 深紅を指す。華やか。"}},
  "gates":{variants:[["芸津","ゲイツ"]],desc:{foreign:"🌐 English surname.",extra:"✦ Known via Bill Gates.",jp:"日本語: 英語の姓。ビル・ゲイツで著名。"}},
  "smith":{variants:[["寿見酢","スミス"]],desc:{foreign:"🌐 Occupational surname.",extra:"✦ Most common in US/UK.",jp:"日本語: 鍛冶屋由来。"}},
  "johnson":{variants:[["実音尊","ジョンソン"]],desc:{foreign:"🌐 “son of John.”",extra:"✦ Very common surname.",jp:"日本語: Johnの子。"}}
};

/* ============= エイリアス（ニックネーム対応） ============= */
const aliases = {
  "will":"william","willy":"william","billy":"bill",
  "steven":"steve","stephen":"steve",
  "tommy":"tom","thomas":"tom",
  "mikey":"mike",
  "charlie":"charles","chuck":"charles",
  "liz":"elizabeth","beth":"elizabeth",
  "sophie":"sophia","sofia":"sophia",
  "kenny":"kenneth"
};

/* ============= 本体処理 ============= */
function convert(){
  const raw = document.getElementById('q').value||"";
  const parts = tokenize(raw);
  if(!parts.length){ out.textContent="名前を入力してください。"; return; }

  const MAX_TOKENS=8;
  const capped=parts.slice(0,MAX_TOKENS);
  const truncated=parts.length>MAX_TOKENS?parts.length-MAX_TOKENS:0;

  const blocks=capped.map(token=>lookupOne(token));
  const html=blocks.map((r,i)=>(i?'<hr class="sep">':'')+r.html).join('');
  out.innerHTML=html+(truncated?`<div class="tips">※ 長文のため先頭${MAX_TOKENS}語のみ処理（残り${truncated}語）。短く入力してください。</div>`:"");
}

function lookupOne(token){
  const keyOriginal=token;
  let key=norm(token);
  if(aliases[keyOriginal.toLowerCase()]) key=norm(aliases[keyOriginal.toLowerCase()]);
  if(aliases[key]) key=norm(aliases[key]);

  const data=db[key];
  if(data){ return {hit:true,html:render(keyOriginal,data)}; }

  const cand=Object.keys(db).filter(k=>k.includes(key)).slice(0,8);
  const suggestHtml=`<div class="tips">「${escapeHtml(keyOriginal)}」はまだ登録されていません。</div>${
    cand.length?`<div class="suggest"><div class="tips">もしかして：</div>${cand.map(k=>`<a href="#" onclick="fill('${k}');return false;">${k}</a>`).join('')}</div>`:''}`;
  return {hit:false,html:suggestHtml};
}

function render(name,data){
  const list=data.variants.map(([k,ka])=>
    `<div class="hit">${k} <span class="kana">（${ka}）</span>
      <button class="copybtn" onclick="copyText('${k}（${ka}）')">コピー</button></div>`).join('');
  return `<div class="tips">「${escapeHtml(name)}」の候補 <span class="badge">EN</span></div>
          ${list}
          <div class="desc-foreign">${data.desc.foreign}</div>
          <div class="tips">${data.desc.extra}</div>
          <div class="desc-jp">${data.desc.jp}</div>`;
}
function fill(name){document.getElementById('q').value=name;convert();}
</script>
</body>
</html>
