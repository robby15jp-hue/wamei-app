<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>和名変換（読みやすさ優先＋意味付き）</title>
<style>
  :root{--bg:#0c1020;--card:#151b34;--mut:#9aa3ff;--fg:#ecf0ff;--pri:#7c5cff}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--fg);
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Noto Sans JP,Helvetica,Arial,sans-serif}
  .wrap{max-width:820px;margin:40px auto;padding:20px}
  .card{background:var(--card);border:1px solid rgba(255,255,255,.1);border-radius:14px;padding:20px}
  h1{margin:0 0 16px;font-size:clamp(20px,4.5vw,28px)}
  .hint{color:var(--mut);margin-bottom:14px}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  input{flex:1;min-width:220px;background:#101633;border:1px solid rgba(255,255,255,.15);
    color:var(--fg);padding:14px;border-radius:12px;font-size:16px}
  button{background:var(--pri);color:#fff;border:0;border-radius:12px;padding:14px 18px;font-weight:700}
  .kanji{font-size:clamp(64px,18vw,140px);line-height:1;margin:18px 0 10px;text-align:center}
  .badge{display:inline-block;background:#101633;border:1px solid rgba(255,255,255,.15);
    padding:6px 10px;border-radius:999px;margin-right:8px;color:var(--mut)}
  .mean{background:#101633;border:1px solid rgba(255,255,255,.15);border-radius:12px;padding:14px;margin-top:10px}
  .list{margin:10px 0 0 0;padding-left:18px}
  .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
  .ghost{background:#101633}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>和名変換（WAMEI）</h1>
    <div class="hint">読める当て字を最優先。まず「指名オーバーライド」→無ければ発音ハイブリッド。いつでも同じ名前は同じ結果。</div>
    <div class="row">
      <input id="name" placeholder="例: David, Mike, Karen, Sophia …" />
      <button id="go">変換する ✨</button>
    </div>
  </div>

  <div id="out" class="card" style="margin-top:16px;display:none">
    <div class="kanji" id="kanji">—</div>
    <div>
      <span class="badge" id="kana">kana: —</span>
      <span class="badge" id="roma">romaji: —</span>
    </div>
    <div class="mean">
      <b>意味の要約</b>
      <div id="summary" style="margin-top:6px">—</div>
      <ul class="list" id="perKanji"></ul>
    </div>
    <div class="actions">
      <button class="ghost" id="copy">コピー</button>
      <button class="ghost" id="share">共有</button>
    </div>
  </div>
</div>

<script>
/* 1) 指名オーバーライド：読み・意味を明示。まずここを使います。 */
const OVERRIDES = {
  // 例：David（読める＋ポジティブ）
  "david": { kanji:"出威美都", kana:"デイヴィッド",
             meaning:"“出”=踏み出す、“威”=堂々、 “美”=美しさ、“都”=中心・集う場 → 勇気をもって前へ進み、人が集う中心となる人。" },

  // よく出る名前もいくつか入れてあります（必要に応じて増やせます）
  "mike":  { kanji:"舞行",  kana:"マイク",
             meaning:"“舞”=華やか、“行”=進む → 華やかに前へ進む人。" },
  "karen": { kanji:"香恋",  kana:"カレン",
             meaning:"“香”=かおり高い、“恋”=慈しみ → 品よく人に慕われる。" },
  "tom":   { kanji:"登夢",  kana:"トム",
             meaning:"“登”=伸びる、“夢”=ビジョン → 着実に夢へ登る。" },
  "ken":   { kanji:"健玄",  kana:"ケン",
             meaning:"“健”=健やか、“玄”=奥深さ → 健やかで奥行きのある人。" },
  "james": { kanji:"愛明寿",kana:"ジェームズ",
             meaning:"“愛”=思いやり、“明”=明るさ、“寿”=寿ぎ → 人を照らし長く祝福をもたらす。" },
  "sophia":{ kanji:"蒼伊亜",kana:"ソフィア",
             meaning:"“蒼”=落ち着き、“伊”“亜”=音符 → 落ち着きと知性を感じさせる響き。" }
};

/* 2) 一字ごとの“安全なポジティブ意味”テーブル（抜粋） */
const MEANINGS = {
  "出":"踏み出す/始まり","威":"威厳/勇ましさ","美":"美しさ/調和","都":"中心/集う場",
  "舞":"華やか/表現","行":"進む/実行","香":"品/香り","恋":"慈しみ/慕われる",
  "登":"伸びる/上向き","夢":"ビジョン/希望","健":"健やか/堅実","玄":"奥深さ/神秘",
  "愛":"思いやり/愛情","明":"明るさ/聡明","寿":"長寿/祝福","蒼":"落ち着き/広がり",
  "伊":"よみの当て字","亜":"よみの当て字"
};

/* 3) フォールバック：発音ハイブリッド（簡易）。音→候補の良字を当てる */
const PHONETIC = [
  { re:/de(i|y)/g,  kanji:"出威", kana:"デイ" },   // “デイ”を強くヒント
  { re:/vi|bi/g,    kanji:"美",   kana:"ビ"  },
  { re:/dd|d$/g,    kanji:"",     kana:"ッ"  },     // 促音ヒント（表示は読みのみ）
  { re:/to|t$/g,    kanji:"都",   kana:"ト"  },
  { re:/ma/g,       kanji:"舞",   kana:"マ"  },
  { re:/i|ee/g,     kanji:"伊",   kana:"イ"  },
  { re:/ke|kay/g,   kanji:"桂",   kana:"ケ"  },
  { re:/ren/g,      kanji:"恋",   kana:"レン"},
  { re:/ken/g,      kanji:"健",   kana:"ケン"},
  { re:/so/g,       kanji:"蒼",   kana:"ソ"  },
  { re:/phi|fia|fia|fia/g, kanji:"伊亜", kana:"フィア" }
];

/* 4) ユーティリティ */
const norm = s => (s||"").toLowerCase().replace(/[^a-z]/g,"");  // 英字のみで安定化

function explainPerChar(kanji){
  const items = [];
  for(const ch of kanji){
    if(MEANINGS[ch]) items.push(`${ch} … ${MEANINGS[ch]}`);
  }
  return items;
}

/* 5) 変換本体 */
function convertName(raw){
  const key = norm(raw);
  // 指名オーバーライド最優先
  if(OVERRIDES[key]){
    const o = OVERRIDES[key];
    const per = explainPerChar(o.kanji);
    return {
      kanji:o.kanji, kana:o.kana, romaji:raw, summary:o.meaning, per
    };
  }
  // フォールバック：簡易発音ハイブリッド
  let rest = norm(raw);
  let kanji = "", kana = "";
  for(const rule of PHONETIC){
    if(!rest) break;
    rest = rest.replace(rule.re, (m)=>{ kanji += (rule.kanji||""); kana += rule.kana; return ""; });
  }
  // まだ残る分は無難な当て字で埋める
  if(rest.length){
    for(const ch of rest){
      if(ch==="a") { kanji+="亜"; kana+="ア"; }
      else if(ch==="e"){ kanji+="恵"; kana+="エ"; }
      else if(ch==="o"){ kanji+="央"; kana+="オ"; }
      else if(ch==="n"){ kanji+="恩"; kana+="ン"; }
      else { kanji+="伊"; kana+=ch; }
    }
  }
  const per = explainPerChar(kanji);
  const summary = per.length ? "各字の意味は下記の通りです（安全なポジティブ語彙のみ）。" :
                               "読めることを優先した当て字です。";
  return { kanji, kana, romaji:raw, summary, per };
}

/* 6) UI */
const $ = id => document.getElementById(id);
$("go").onclick = () => {
  const name = $("name").value.trim();
  if(!name){ $("name").focus(); return; }
  const r = convertName(name);

  $("kanji").textContent = r.kanji;
  $("kana").textContent  = "kana: " + r.kana;
  $("roma").textContent  = "romaji: " + r.romaji;
  $("summary").textContent = r.summary;

  const ul = $("perKanji"); ul.innerHTML = "";
  r.per.forEach(t=>{ const li=document.createElement("li"); li.textContent=t; ul.appendChild(li); });

  $("out").style.display = "block";
};
$("copy").onclick = async () => {
  const text = `${$("kanji").textContent}（${$("kana").textContent.replace('kana: ','')}）`;
  try{ await navigator.clipboard.writeText(text);}catch(e){}
};
$("share").onclick = async () => {
  const title = "和名変換";
  const text = `${$("kanji").textContent} / ${$("kana").textContent}`;
  try{ await navigator.share({title,text}); }catch(e){}
};

/* デモ初期値 */
$("name").value = "David";
document.addEventListener("DOMContentLoaded", ()=>$("go").click());
</script>
</body>
</html>
